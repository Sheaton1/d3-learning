<html>
  <head>
    <title>作业六：用 Vega-Lite 实现交互</title>
  </head>
  <body>
    <h1>作业六：用 Vega-Lite 实现交互</h1>
    <p>1. 完成散点图刷选变色的交互。</p>
    <p>2. 完成散点图平移缩放的交互。</p>
    <p>3. 完成散点图刷选、过滤的交互。</p>
    <div id="work1"></div>
    <div id="work2"></div><br>
    <div id="work3"></div>

    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <script>

      const dataUrl = 'https://vega.github.io/vega-lite/examples/data/cars.json'
      const workSpec1 = {
        data: {
          url: dataUrl
        },
        selection:{
          brush:{
            type: 'interval',
          }
        },
        mark: 'point',
        encoding: {
          x: {field: 'Horsepower', type: 'quantitative'},
          y: {field: 'Miles_per_Gallon', type: 'quantitative'},
          color:{
            condition:{
              selection:'brush',field:'Cylinders',type:'ordinal'
            },
            value:'grey'
          }
        }
      }

      const workSpec2 = {
        data: {
          url: dataUrl
        },
        selection:{
          grid:{
            type: 'interval',
            bind: 'scales'
          }
        },
        mark: 'point',
        encoding: {
          x: {field: 'Horsepower', type: 'quantitative', scale:{domain:[0,250]}},
          y: {field: 'Miles_per_Gallon', type: 'quantitative', scale:{domain:[0,50]}},
          size: {field: 'Cylinders', type: 'quantitative'}
        }
      }

      const workSpec3 = {
        data: {
          url: dataUrl
        },
        transform: [{
          window: [{op: 'row_number', as: 'row_number'}]
        }],
        hconcat: [
        {
          selection: {
            brush: {
              type: 'interval'
            }
          },
          mark: 'point',
          encoding: {
            x: {field: 'Horsepower', type: 'quantitative', scale:{domain:[0,250]}},
            y: {field: 'Miles_per_Gallon', type: 'quantitative', scale:{domain:[0,50]}},
            color:{
              condition:{
                selection:'brush',field:'Cylinders',type:'ordinal'
              },
              value:'grey'
            }
          }
        },
        {
          transform: [
            {filter: {selection: 'brush'}},
            {window: [{op: 'rank', as: 'rank'}]},
            {filter: {field: 'rank', lt: 20}}
          ],
          hconcat: [{
            width: 50,
            title: 'Horsepower',
            mark: 'text',
            encoding: {
              text: {field: 'Horsepower', type: 'nominal'},
              y: {field: 'row_number', type: 'ordinal', axis: null}
            }
          },{
            width: 50,
            title: 'MPG',
            mark: 'text',
            encoding: {
              text: {field: 'Miles_per_Gallon', type: 'nominal'},
              y: {field: 'row_number', type: 'ordinal', axis: null}
            }
          },{
            width: 50,
            title: 'Origin',
            mark: 'text',
            encoding: {
              text: {field: 'Origin', type: 'nominal'},
              y: {field: 'row_number', type: 'ordinal', axis: null}
            }
          }]
        }
        ],
        resolve: {legend: {color: 'independent'}}
      }

      vegaEmbed('#work1', workSpec1)
      vegaEmbed('#work2', workSpec2)
      vegaEmbed('#work3', workSpec3)

    </script>
  </body>
</html>
